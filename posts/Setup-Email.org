#+title: Mail Configuration Using msmtp, isync, goimapnotify and notmuch
#+subtitle: Part of Living your live in text mode series
#+date: <2022-03-23 Wed>
#+author: Kristian Alexander P
#+email: alexforsale@yahoo.com
#+language: en
#+startup: hideblocks overview inlineimages

#+attr_html: :class center no-border :width 75% :height 75%
#+attr_org: :width 200
[[../images/posts/notmuch1.png]]
#+attr_html: :class center no-border :width 75% :height 75%
#+attr_org: :width 200
[[../images/posts/notmuch2.png]]
* Mail
  As per other posts in this blog, this is my actual configuration used in various machines. One benefit I can think of is with this setup is that I can use different clients[fn:1], of course here I'm using /notmuch-emacs/.
  I have four accounts configured in this setup:
  1. Gmail
     My primary account.
  2. Yahoo
     My "bulk" mail, usually for subscribing to news, mailing lists and such.
  3. Hotmail
     A.K.A /windowslive/. Not used often but still needed for connecting to /ms/ stuffs.
  4. ymail
     Few mailing lists and stuffs.
** msmtp
   Configuration can be stored in =~/.msmtprc= or =~/.config/msmtp/config=.
   #+begin_src conf :tangle ~/.config/msmtp/config :mkdirp t
     # Set default values for all following accounts.
     defaults
     auth           on
     tls            on
     tls_trust_file /etc/ssl/certs/ca-certificates.crt
     logfile        ~/.local/share/mail/msmtp.log

     # Gmail
     account        gmail
     host           smtp.gmail.com
     port           587
     from           alexarians@gmail.com
     user           alexarians
     passwordeval   "gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.local/etc/mail/mailpass-gmail.gpg"

     # Yahoo service
     account        yahoo
     auth           on
     tls            on
     tls_trust_file /etc/ssl/certs/ca-certificates.crt
     host           smtp.mail.yahoo.com
     port           587
     from           alexforsale@yahoo.com
     user           alexforsale
     passwordeval   "gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.local/etc/mail/mailpass-yahoo.gpg"

     # Hotmail
     account        hotmail
     auth           on
     tls            on
     tls_trust_file /etc/ssl/certs/ca-certificates.crt
     #tls_certcheck  off
     host           smtp-mail.outlook.com
     port           587
     from           christian.alexander@windowslive.com
     user           christian.alexander@windowslive.com
     passwordeval   "gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.local/etc/mail/mailpass-hotmail.gpg"

     # Ymail service
     account        ymail
     auth           on
     tls            on
     tls_trust_file /etc/ssl/certs/ca-certificates.crt
     host           smtp.mail.yahoo.com
     port           587
     from           christian.alexander@ymail.com
     user           christian.alexander@ymail.com
     passwordeval   "gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.local/etc/mail/mailpass-ymail.gpg"

     # Set a default account
     account default : yahoo

   #+end_src
   To easily encript the files in =~/.local/etc/mail/=, open the file in /Emacs/ and save it with =.gpg= extension, if you've setup gpg(see arch wiki for [[https://wiki.archlinux.org/title/GnuPG][that]]) it'll prompt you for the key to encrypt. Another option is to use /password-store/ to store the password, details also in [[https://wiki.archlinux.org/title/Msmtp][arch wiki]].
** CANCELLED isync
   CLOSED: [2022-03-29 Tue 21:12]
   :LOGBOOK:
   - State "CANCELLED"  from              [2022-03-29 Tue 21:12]
   :END:
   For a while, /isync/ works greate for me, but synchronizing around 86000 emails took a while, which meant using imapnotify is kinda pointless (I need to manually kill and restart /mbsync/ to pull new mails). I'm keeping this configuration here just in case I need to revert back.
   This is what I configured in =~/.mbsyncrc=:
*** IMAP Account
    This set up the necessary information on connecting to the IMAP server.
    #+begin_src conf :tangle ~/.mbsyncrc
      IMAPAccount gmail
      # Address to connect to
      Host imap.gmail.com
      User alexarians@gmail.com
      # Pass ***************
      # To store the password in an encrypted file use PassCmd instead of Pass
      PassCmd "gpg -q --for-your-eyes-only --no-tty -d ~/.local/etc/mail/mailpass-gmail.gpg"
      #
      # Use SSL
      SSLType IMAPS
      # The following line should work. If get certificate errors, uncomment the two following lines and read the "Troubleshooting" section.
      CertificateFile /etc/ssl/certs/ca-certificates.crt
      #CertificateFile ~/.cert/imap.gmail.com.pem
      #CertificateFile ~/.cert/Equifax_Secure_CA.pem

      IMAPAccount yahoo
      Host imap.mail.yahoo.com
      User alexforsale@yahoo.com
      PassCmd "gpg -q --for-your-eyes-only --no-tty -d ~/.local/etc/mail/mailpass-yahoo.gpg"
      SSLType IMAPS
      CertificateFile /etc/ssl/certs/ca-certificates.crt
      PipelineDepth 10

      IMAPAccount ymail
      Host imap.mail.yahoo.com
      User christian.alexander@ymail.com
      PassCmd "gpg -q --for-your-eyes-only --no-tty -d ~/.local/etc/mail/mailpass-ymail.gpg"
      SSLType IMAPS
      CertificateFile /etc/ssl/certs/ca-certificates.crt
      PipelineDepth 10

      IMAPAccount hotmail
      Host imap-mail.outlook.com
      User christian.alexander@windowslive.com
      PassCmd "gpg -q --for-your-eyes-only --no-tty -d ~/.local/etc/mail/mailpass-hotmail.gpg"
      SSLType IMAPS
      CertificateFile /etc/ssl/certs/ca-certificates.crt
     #+end_src
*** Gmail
    #+begin_src conf :tangle ~/.mbsyncrc
      IMAPStore gmail-remote
      Account gmail

      MaildirStore gmail-local
      SubFolders Verbatim
      # The trailing "/" is important
      Path /home/alexforsale/.mail/gmail/
      Inbox /home/alexforsale/.mail/gmail/Inbox

      Channel gmail-trash
      Far :gmail-remote:"[Gmail]/Trash"
      Near :gmail-local:trash
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel gmail-sent
      Far :gmail-remote:"[Gmail]/Sent Mail"
      Near :gmail-local:sent
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel gmail-drafts
      Far :gmail-remote:"[Gmail]/Drafts"
      Near :gmail-local:draft
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel gmail-allmail
      Far :gmail-remote:"[Gmail]/All Mail"
      Near :gmail-local:archive
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel gmail-spam
      Far :gmail-remote:"[Gmail]/Spam"
      Near :gmail-local:spam
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel gmail-other
      Far :gmail-remote:
      Near :gmail-local:
      Patterns * "![Gmail]/*" "!trash*" "!sent*" "!draft*" "!archive*" "!spam*" "!INBOX" "!Inbox"
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel gmail-inbox
      Far :gmail-remote:INBOX
      Near :gmail-local:Inbox
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Group gmail
      Channel gmail-inbox
      Channel gmail-sent
      Channel gmail-drafts
      Channel gmail-trash
      Channel gmail-allmail
      Channel gmail-other
      Channel gmail-spam
    #+end_src
*** Yahoo
    #+begin_src conf :tangle ~/.mbsyncrc
      IMAPStore yahoo-remote
      Account yahoo

      MaildirStore yahoo-local
      SubFolders Verbatim
      Path /home/alexforsale/.mail/yahoo/
      Inbox /home/alexforsale/.mail/yahoo/Inbox

      Channel yahoo-draft
      Far :yahoo-remote:Draft
      Near :yahoo-local:draft
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel yahoo-trash
      Far :yahoo-remote:Trash
      Near :yahoo-local:trash
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel yahoo-sent
      Far :yahoo-remote:Sent
      Near :yahoo-local:sent
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel yahoo-spam
      Far :yahoo-remote:"Bulk Mail"
      Near :yahoo-local:spam
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel yahoo-archive
      Far :yahoo-remote:Archive
      Near :yahoo-local:archive
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel yahoo-other
      Far :yahoo-remote:
      Near :yahoo-local:
      Create Both
      Patterns *"!Draft*" "!draft*" "!Trash*" "!trash*" "!Sent*" "!sent*" "!Bulk Mail*" "!spam*" "!Archive*" "!archive" "!INBOX*" "!Inbox*"
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel yahoo-inbox
      Far :yahoo-remote:INBOX
      Near :yahoo-local:Inbox
      Create Near
      SyncState *
      CopyArrivalDate yes

      Group yahoo
      Channel yahoo-spam
      Channel yahoo-inbox
      Channel yahoo-draft
      Channel yahoo-sent
      Channel yahoo-archive
      Channel yahoo-trash
      Channel yahoo-other
    #+end_src
*** Hotmail
    #+begin_src conf :tangle ~/.mbsyncrc
      IMAPStore hotmail-remote
      Account hotmail

      MaildirStore hotmail-local
      SubFolders Verbatim
      Path /home/alexforsale/.mail/hotmail/
      Inbox /home/alexforsale/.mail/hotmail/Inbox

      Channel hotmail-sent
      Far :hotmail-remote:Sent
      Near :hotmail-local:sent
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel hotmail-inbox
      Far :hotmail-remote:INBOX
      Near :hotmail-local:Inbox
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel hotmail-archive
      Far :hotmail-remote:Archive
      Near :hotmail-local:archive
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel hotmail-trash
      Far :hotmail-remote:Deleted
      Near :hotmail-local:trash
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel hotmail-draft
      Far :hotmail-remote:Drafts
      Near :hotmail-local:draft
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel hotmail-spam
      Far :hotmail-remote:Junk
      Near :hotmail-local:spam
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel hotmail-notes
      Far :hotmail-remote:Notes
      Near :hotmail-local:notes
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel hotmail-outbox
      Far :hotmail-remote:Outbox
      Near :hotmail-local:outbox
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel hotmail-other
      Far :hotmail-remote:
      Near :hotmail-local:
      Patterns * "!Sent*" "!sent*" "!INBOX*" "!Inbox*" "!Archive*" "!archive*" "!Deleted*" "!trash*" "!Drafts*" "!draft*" "!Junk*" "!spam*" "!Notes*" "!notes*" "!Outbox*" "!outbox*"
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Group hotmail
      Channel hotmail-inbox
      Channel hotmail-sent
      Channel hotmail-archive
      Channel hotmail-trash
      Channel hotmail-draft
      Channel hotmail-spam
      Channel hotmail-notes
      Channel hotmail-other
    #+end_src
*** Ymail
    #+begin_src conf :tangle ~/.mbsyncrc
      IMAPStore ymail-remote
      Account ymail

      MaildirStore ymail-local
      SubFolders Verbatim
      Path /home/alexforsale/.mail/ymail/
      Inbox /home/alexforsale/.mail/ymail/Inbox

      Channel ymail-spam
      Far :ymail-remote:"Bulk Mail"
      Near :ymail-local:spam
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel ymail-draft
      Far :ymail-remote:Draft
      Near :ymail-local:draft
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel ymail-inbox
      Far :ymail-remote:INBOX
      Near :ymail-local:Inbox
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel ymail-sent
      Far :ymail-remote:Sent
      Near :ymail-local:sent
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel ymail-trash
      Far :ymail-remote:Trash
      Near :ymail-local:trash
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel ymail-archive
      Far :ymail-remote:Archive
      Near :ymail-local:archive
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Channel ymail-other
      Far :ymail-remote:
      Near :ymail-local:
      Patterns * "!INBOX*" "!Archive*" "!Sent*" "!Bulk Mail*" "!Draft*" "!Trash*" "!Inbox*" "!archive*" "!sent*" "!spam*" "!draft*" "!trash*"
      Create Both
      CopyArrivalDate yes
      Sync All
      Remove Both
      Expunge Both
      SyncState *

      Group ymail
      Channel ymail-inbox
      Channel ymail-spam
      Channel ymail-draft
      Channel ymail-sent
      Channel ymail-trash
      Channel ymail-archive
      Channel ymail-other
    #+end_src
    Run ~mbsync -Va~ for verbose logging to stdout. After that you could create a [[https://wiki.archlinux.org/title/Isync#Calling_mbsync_automatically][systemd user unit]], or use /goimapnotify/ to get push notification(almost?).
** notmuch
   run ~notmuch setup~ for initializing mail accounts, and ~notmuch new~ *AFTER* all your mailboxes syncronized.
** offlineimap
   :PROPERTIES:
   :header-args: :tangle ~/.config/offlineimap/config :mkdirp t
   :END:
   The configuration file can be stored at =~/.offlineimaprc= or =~/.config/offlineimap/config=, I chose the latter.
*** General options
    List the accounts that will be managed by offlineimap
    #+begin_src python
      [general]
      accounts = gmail, hotmail, ymail, yahoo
    #+end_src
*** Controls how many accounts may be synced simultaneously
    #+begin_src python
      maxsyncaccounts = 1
    #+end_src
*** Set =pythonfile=
    This is an helper script used by /offlineimap/. If this file is not located within =$PATH=, provide full path.
    #+begin_src python
      pythonfile = ~/.local/share/offlineimap/offlineimap.py
    #+end_src
**** The =offlineimap.py= content
     #+begin_src python :tangle ~/.local/share/offlineimap/offlineimap.py :mkdirp t :shebang #!/usr/bin/env python
       """Offlineimap helper script."""

       from subprocess import check_output


       def get_pass(account):
           """Return password for ACCOUNT."""
           match account:
               case "yahoo":
                   return check_output(
                       "pass login.yahoo.com/app_pass/alexforsale@yahoo.com",
                       shell=True).decode('utf-8').strip('\n')
               case "ymail":
                   return check_output(
                       "pass login.yahoo.com/app_pass/christian.alexander@ymail.com",
                       shell=True).decode('utf-8').strip('\n')
               case "gmail":
                   return check_output(
                       "pass google.com/app_pass/alexarians@gmail.com",
                       shell=True).decode('utf-8').strip('\n')
               case "hotmail":
                   return check_output(
                       "pass outlook.live.com/christian.alexander@windowslive.com",
                       shell=True).decode('utf-8').strip('\n')
     #+end_src
*** Credentials for gmail account
    #+begin_src python
      [Account gmail]
      localrepository = gmail-local
      remoterepository = gmail-remote
      synclabels = yes
      labelsheader = X-Keywords
      autorefresh = 5
      quick = 10

      [Repository gmail-local]
      Type = GmailMaildir
      localfolders = ~/.mail/gmail
      sync_deletes = yes
      nametrans = lambda f: re.sub('spam', '[Gmail]/Spam',
                           re.sub('draft', '[Gmail]/Drafts',
                           re.sub('inbox', 'INBOX',
                           re.sub('sent', '[Gmail]/Sent Mail',
                           re.sub('trash', '[Gmail]/Trash',
                           re.sub('archive', '[Gmail]/All Mail', f))))))

      [Repository gmail-remote]
      Type = Gmail
      remoteuser = alexarians@gmail.com
      remotepasseval = get_pass("gmail")
      nametrans = lambda f: re.sub('.*All Mail$', 'archive',
                                   re.sub('.*Drafts$', 'draft',
                                          re.sub('.*Spam$', 'spam',
                                                 re.sub('.*Sent Mail$', 'sent',
                                                        re.sub('.*Trash$', 'trash',
                                                               re.sub('INBOX', 'inbox', f))))))

      folderfilter = lambda foldername: foldername not in ['[Gmail]/Important', '[Gmail]/Starred']
      sslcacertfile = /etc/ssl/certs/ca-certificates.crt
      ssl_version = tls1_2
      usecompression = yes
    #+end_src
*** Yahoo
    #+begin_src python
      [Account yahoo]
      localrepository = yahoo-local
      remoterepository = yahoo-remote
      autorefresh = 5
      quick = 10

      [Repository yahoo-local]
      Type = Maildir
      localfolders = ~/.mail/yahoo
      sync_deletes = yes
      nametrans = lambda f: re.sub('spam', 'Bulk Mail',
                           re.sub('draft', 'Draft',
                           re.sub('inbox', 'Inbox',
                           re.sub('sent', 'Sent',
                           re.sub('trash', 'Trash',
                           re.sub('archive', 'Archive', f))))))

      [Repository yahoo-remote]
      Type = IMAP
      remotehost = imap.mail.yahoo.com
      remoteuser = alexforsale@yahoo.com
      remotepasseval = get_pass("yahoo")
      nametrans = lambda f: re.sub('.*Archive$', 'archive',
                                   re.sub('.*Draft$', 'draft',
                                          re.sub('.*Bulk Mail$', 'spam',
                                                 re.sub('.*Sent$', 'sent',
                                                        re.sub('.*Trash$', 'trash',
                                                               re.sub('Inbox', 'inbox', f))))))
      sslcacertfile = /etc/ssl/certs/ca-certificates.crt
      ssl_version = tls1_2
      usecompression = no
    #+end_src
*** Hotmail
    #+begin_src python
      [Account hotmail]
      localrepository = hotmail-local
      remoterepository = hotmail-remote
      autorefresh = 5
      quick = 10

      [Repository hotmail-local]
      Type = Maildir
      localfolders = ~/.mail/hotmail
      sync_deletes = yes
      nametrans = lambda f: re.sub('spam', 'Junk',
                           re.sub('draft', 'Drafts',
                           re.sub('inbox', 'Inbox',
                           re.sub('sent', 'Sent',
                           re.sub('trash', 'Deleted',
                           re.sub('notes', 'Notes',
                           re.sub('outbox', 'Outbox',
                           re.sub('archive', 'Archive', f))))))))
      [Repository hotmail-remote]
      Type = IMAP
      remotehost = imap-mail.outlook.com
      remoteuser = christian.alexander@windowslive.com
      remotepasseval = get_pass("hotmail")
      nametrans = lambda f: re.sub('.*Archive$', 'archive',
                            re.sub('.*Drafts$', 'draft',
                            re.sub('.*Junk$', 'spam',
                            re.sub('.*Sent$', 'sent',
                            re.sub('.*Deleted$', 'trash',
                            re.sub('.*Outbox$', 'outbox',
                            re.sub('.*Notes$', 'notes',
                            re.sub('Inbox', 'inbox', f))))))))
      sslcacertfile = /etc/ssl/certs/ca-certificates.crt
      ssl_version = tls1_2
      usecompression = no
    #+end_src
*** Ymail
    #+begin_src python
      [Account ymail]
      localrepository = ymail-local
      remoterepository = ymail-remote
      autorefresh = 5
      quick = 10

      [Repository ymail-local]
      Type = Maildir
      localfolders = ~/.mail/ymail
      sync_deletes = yes
      nametrans = lambda f: re.sub('spam', 'Bulk Mail',
                           re.sub('draft', 'Draft',
                           re.sub('inbox', 'Inbox',
                           re.sub('sent', 'Sent',
                           re.sub('trash', 'Trash',
                           re.sub('archive', 'Archive', f))))))

      [Repository ymail-remote]
      Type = IMAP
      remotehost = imap.mail.yahoo.com
      remoteuser = christian.alexander@ymail.com
      remotepasseval = get_pass("ymail")
      nametrans = lambda f: re.sub('.*Archive$', 'archive',
                                   re.sub('.*Draft$', 'draft',
                                          re.sub('.*Bulk Mail$', 'spam',
                                                 re.sub('.*Sent$', 'sent',
                                                        re.sub('.*Trash$', 'trash',
                                                               re.sub('Inbox', 'inbox', f))))))
      sslcacertfile = /etc/ssl/certs/ca-certificates.crt
      ssl_version = tls1_2
      usecompression = no
    #+end_src
** goimapnotify
   Needs separate configuration file for each accounts, here I'm using /password-store/.
   - gmail
     #+begin_src conf :tangle ~/.config/imapnotify/gmail.conf :mkdirp t
       {
       "host": "imap.gmail.com",
       "port": 993,
       "tls": true,
       "tlsOptions": {
       "rejectUnauthorized": false
       },
       "username": "alexarians@gmail.com",
       "password": "",
       "passwordCmd": "pass show google.com/app_pass/alexarians@gmail.com | head -n1",
       "onNewMail": "offlineimap -sa gmail",
       "onNewMailPost": "notmuch new",
       "wait": 20,
       "boxes": [ "Inbox" ]
       }
     #+end_src
   - yahoo
     #+begin_src conf :tangle ~/.config/imapnotify/yahoo.conf
       {
       "host": "imap.mail.yahoo.com",
       "port": 993,
       "tls": true,
       "tlsOptions": {
       "rejectUnauthorized": false
       },
       "username": "alexforsale@yahoo.com",
       "password": "",
       "passwordCmd": "pass show login.yahoo.com/app_pass/alexforsale@yahoo.com | head -n1",
       "onNewMail": "offlineimap -sa yahoo",
       "onNewMailPost": "notmuch new",
       "wait": 20,
       "boxes": [ "Inbox" ]
       }
     #+end_src
   - hotmail
     #+begin_src conf :tangle ~/.config/imapnotify/hotmail.conf
       {
       "host": "imap-mail.outlook.com",
       "port": 993,
       "tls": true,
       "tlsOptions": {
       "rejectUnauthorized": false
       },
       "username": "christian.alexander@windowslive.com",
       "password": "",
       "passwordCmd": "pass show outlook.live.com/christian.alexander@windowslive.com | head -n1",
       "onNewMail": "offlineimap -sa hotmail",
       "onNewMailPost": "notmuch new",
       "wait": 20,
       "boxes": [ "Inbox" ]
       }
     #+end_src
   - ymail
     #+begin_src conf :tangle ~/.config/imapnotify/ymail.conf
       {
       "host": "imap.mail.yahoo.com",
       "port": 993,
       "tls": true,
       "tlsOptions": {
       "rejectUnauthorized": false
       },
       "username": "christian.alexander@ymail.com",
       "password": "",
       "passwordCmd": "pass show login.yahoo.com/app_pass/christian.alexander@ymail.com | head -n1",
       "onNewMail": "offlineimap -sa ymail",
       "onNewMailPost": "notmuch new",
       "wait": 20,
       "boxes": [ "Inbox" ]
       }
     #+end_src
     Notice how each account calls /mbsync/ separately. Enable the systemd user units
     #+begin_src sh
       systemctl --user enable --now goimapnotify@{gmail,yahoo,hotmail,ymail}
     #+end_src

* Footnotes

[fn:1] see [[https://notmuchmail.org/frontends/][here]] for the list of available frontends.

#+include: ../utterances.inc
