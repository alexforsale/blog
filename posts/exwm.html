<!DOCTYPE html>
<html lang="en">
<head>
<!-- Jun 03, 2022 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EXWM</title>
<meta name="author" content="Kristian Alexander P" />
<meta name="generator" content="Org Mode" />
<link rel='icon' type='image/x-icon' href='/blog/images/favicon.jpg'/><meta name='viewport' content='width=device-width, initial-scale=1'><link rel='stylesheet' href='https://code.cdn.mozilla.net/fonts/fira.css'><link rel='stylesheet' href='/blog/css/site.css' type='text/css'/><link rel='stylesheet' href='/blog/css/custom.css' type='text/css'/><link rel='stylesheet' href='/blog/css/syntax-coloring.css' type='text/css'/>
<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
// @license-end
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="/blog"> UP </a>
 |
 <a accesskey="H" href="/blog"> HOME </a>
</div><header id="top" class="status">
<!--TODO: update this -->
<div class='intro'>
  <img src='/blog/images/about/profile.png' alt='Kristian Alexander P' class='no-border'/>
  <h1>
    <span>Kristian Alexander</span>
  </h1>
  <p>Free Software Enthusiast | GNU Emacs User</p>
</div>

<div class='nav'>
  <ul>
    <li><a href='/'>Website</a>.</li>
    <li><a href='/blog/index.html'>Home</a>.</li>
    <li><a href='/blog/posts/index.html'>Posts</a>.</li>
    <li><a href='/blog/index.xml'>RSS</a>.</li>
    <li><a href='/blog/about.html'>About</a></li>
  </ul>
</div>
</header>
<main id="content" class="content">
<header>
<h1 class="title">EXWM</h1>
<p class="subtitle" role="doc-subtitle">Published on Jun 02, 2022 by Kristian Alexander P.</p>
</header>
<section id="outline-container-org15636b9" class="outline-2">
<h2 id="org15636b9">Configuration</h2>
<div class="outline-text-2" id="text-org15636b9">
<pre class="example">
header-args: :tangle ~/.config/exwm/config :mkdirp t
</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">Config --- Exwm Configuration -*- emacs-lisp -*-</span>
<span class="org-comment-delimiter">;;; </span><span class="org-comment">Commentary:</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">This configuration should not depends</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">on `</span><span class="org-comment"><span class="org-constant">user-init-file</span></span><span class="org-comment">' but should detect if</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">it uses `</span><span class="org-comment"><span class="org-constant">straight.el</span></span><span class="org-comment">'.</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">Code:</span>
</pre>
</div>
</div>
<div id="outline-container-org5607c21" class="outline-3">
<h3 id="org5607c21">package installation</h3>
<div class="outline-text-3" id="text-org5607c21">
<p>
As the commentary heading suggests, this <i>exwm</i> configuration should work even with no <i>Emacs</i> configuration file. But if you&rsquo;re using not using <i>Emacs</i> why using <i>exwm</i>?
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">if</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">straight</span>)
    (<span class="org-keyword">progn</span>
      (straight-use-package 'exwm)
      (straight-use-package 'pinentry)
      (straight-use-package 'desktop-environment)
      (straight-use-package 'perspective)
      (straight-use-package 'perspective-exwm))
  (<span class="org-keyword">progn</span>
    (<span class="org-keyword">require</span> '<span class="org-constant">package</span>)
    (package-initialize)
    (customize-set-variable 'package-archives
                            '((<span class="org-string">"gnu"</span> . <span class="org-string">"https://elpa.gnu.org/packages/"</span>)
                              (<span class="org-string">"nongnu"</span> . <span class="org-string">"https://elpa.nongnu.org/nongnu/"</span>)
                              (<span class="org-string">"melpa"</span> . <span class="org-string">"https://melpa.org/packages/"</span>)))
    (<span class="org-keyword">unless</span>
        (<span class="org-keyword">featurep</span> '<span class="org-constant">package-archive-contents</span>)
      (package-refresh-contents))
    (package-install 'exwm)
    (package-install 'desktop-environment)
    (package-install 'pinentry)
    (package-install 'perspective)
    (package-install 'perspective-exwm)))
</pre>
</div>
<p>
The packages installed:
</p>
<dl class="org-dl">
<dt>exwm</dt><dd>the <i>EXWM</i> package.</dd>
<dt>pinentry</dt><dd><code>GnuPG Pinentry</code> server implementation.</dd>
<dt>desktop-environment</dt><dd>The package desktop-environment provides commands and a global minor mode to control your GNU/Linux desktop from Emacs.</dd>
<dt>perspective</dt><dd>The Perspective package provides multiple named workspaces (or &ldquo;perspectives&rdquo;) in <i>Emacs</i>, similar to multiple desktops in window managers like <i>Awesome</i> and <i>XMonad</i>, and <i>Spaces</i> on the Mac.</dd>
<dt>perspective-exwm</dt><dd>A couple of tricks and fixes to make using <a href="https://github.com/ch11ng/exwm">EXWM</a> and <a href="https://github.com/nex3/perspective-el">perspective.el</a> a better experience.</dd>
</dl>
<p>
<code>package-archives</code> is an <i>alist</i> of archives (package repositories) from which to fetch. <i>gnu</i> and <i>nongnu</i> are the defaults. As for the package installation method is determined by the <code>featurep</code> function, <code>package-install</code> is an <i>Emacs</i> builtin and <a href="https://github.com/radian-software/straight.el">straight.el</a> is a next-generation, purely functional package manager for the Emacs hacker.
</p>
</div>
</div>
<div id="outline-container-orgab1c827" class="outline-3">
<h3 id="orgab1c827">Variables and custom functions</h3>
<div class="outline-text-3" id="text-orgab1c827">
</div>
<div id="outline-container-org7fae851" class="outline-4">
<h4 id="org7fae851">Functions</h4>
<div class="outline-text-4" id="text-org7fae851">
</div>
<ul class="org-ul">
<li><a id="org9f22275"></a>Background command<br>
<div class="outline-text-5" id="text-org9f22275">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">exwm/run-in-background</span> (command)
  <span class="org-doc">"Run COMMAND in background if exists."</span>
  (<span class="org-keyword">let</span> ((command-parts (split-string command <span class="org-string">"[ ]+"</span>)))
    (<span class="org-keyword">when</span> (executable-find (car command-parts))
      (apply #'call-process `(,(car command-parts) nil 0 nil ,@(cdr command-parts))))))
</pre>
</div>
<p>
This is a wrapper function mainly used for starting up <i>services</i> and <i>daemons</i> related to <i>Xorg</i> startups. This is taken(<del>stolen</del>) from <a href="https://config.daviwil.com/desktop">https://config.daviwil.com/desktop</a>.
</p>
</div>
</li>
<li><a id="org2fa06be"></a>fix exwm floating window<br>
<div class="outline-text-5" id="text-org2fa06be">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+config/fix-exwm-floating-windows</span> ()
  <span class="org-doc">"Fix behaviour when switching to floating."</span>
  (<span class="org-keyword">setq-local</span> exwm-workspace-warp-cursor nil)
  (<span class="org-keyword">setq-local</span> mouse-autoselect-window nil)
  (<span class="org-keyword">setq-local</span> focus-follows-mouse nil))
</pre>
</div>
<p>
This function is for the <code>exwm-floating-setup-hook</code>. I think this was from <i>daviwil</i> config.
</p>
</div>
</li>
<li><a id="org8766ea9"></a>exwm init hook wrapper<br>
<div class="outline-text-5" id="text-org8766ea9">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">things that should runs after initializing exwm</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">+config/exwm-init-hook</span> ()
  <span class="org-doc">"Things that should run after initialization."</span>
  (<span class="org-keyword">when</span> (file-exists-p <span class="org-string">"~/.fehbg"</span>)
    (exwm/run-in-background <span class="org-string">"~/.fehbg"</span>))
  (exwm/run-in-background <span class="org-string">"xsetroot -cursor_name left_ptr"</span>)
  (exwm/run-in-background <span class="org-string">"xset r rate 300 30"</span>)
  (exwm/run-in-background <span class="org-string">"nm-applet"</span>)
  (exwm/run-in-background <span class="org-string">"/usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1"</span>)
  (exwm/run-in-background <span class="org-string">"picom"</span>)
  (exwm/run-in-background <span class="org-string">"udiskie -t"</span>)
  (exwm/run-in-background <span class="org-string">"dunst"</span>)
  (exwm/run-in-background <span class="org-string">"blueman-applet"</span>)
  (exwm/run-in-background <span class="org-string">"xsettingsd"</span>)
  (exwm/run-in-background <span class="org-string">"unclutter"</span>))
</pre>
</div>
<p>
The process that should be started after <i>EXWM</i> initialize.
</p>
<dl class="org-dl">
<dt>~/.fehbg</dt><dd>This is a shell scripts created by the <code>feh</code> applications, it saves the last wallpaper(s) used in the previous <code>feh</code> invocation.</dd>
<dt>xsetroot</dt><dd>This program allows you to tailor the appearance of the background (&ldquo;root&rdquo;) window on a workstation display running X. the <code>-cursor_name</code> arguments set the cursor&rsquo;s pointer (this is what the <i>EXWM</i> <a href="https://github.com/ch11ng/exwm/wiki">wiki</a> recommends).</dd>
<dt>xset</dt><dd>Used to set various user preference options of the display. The <code>r</code> option controls the <i>keyboard autorepeat</i> with the first argument after rate (300) specifies the <i>delay</i> and the second (30) specifies the rate. This value is also what the <a href="https://github.com/ch11ng/exwm/wiki">wiki</a> recommends.</dd>
<dt>nm-applet</dt><dd>Tray indicator for <i>networkmanager</i>. I don&rsquo;t use <i>system-tray</i> in <i>EXWM</i> so this is not doing anything now.</dd>
<dt>polkit-gnome</dt><dd>Also not currently in use, I still considering whether this is actually needed for a <i>window-manager</i>.</dd>
<dt>picom</dt><dd>an X compositor</dd>
</dl>
</div>
</li>
<li><a id="org04298e1"></a>setup window by class<br>
<div class="outline-text-5" id="text-org04298e1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+config/setup-window-by-class</span> ()
  <span class="org-doc">"Set rule based on window class name."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">pcase</span> exwm-class-name
    (<span class="org-string">"XTerm"</span> (perspective-exwm-assign-window
              <span class="org-builtin">:workspace-index</span> 0
              <span class="org-builtin">:persp-name</span> <span class="org-string">"Term"</span>))
    (<span class="org-string">"Termite"</span> (perspective-exwm-assign-window
                <span class="org-builtin">:workspace-index</span> 0
                <span class="org-builtin">:persp-name</span> <span class="org-string">"Term"</span>))
    (<span class="org-string">"URxvt"</span> (perspective-exwm-assign-window
              <span class="org-builtin">:workspace-index</span> 0
              <span class="org-builtin">:persp-name</span> <span class="org-string">"Term"</span>))
    (<span class="org-string">"firefox"</span> (perspective-exwm-assign-window
                <span class="org-builtin">:workspace-index</span> 2
                <span class="org-builtin">:persp-name</span> <span class="org-string">"Web"</span>))
    (<span class="org-string">"Nyxt"</span> (perspective-exwm-assign-window
             <span class="org-builtin">:workspace-index</span> 2
             <span class="org-builtin">:persp-name</span> <span class="org-string">"Web"</span>))
    (<span class="org-string">"qutebrowser"</span> (perspective-exwm-assign-window
                    <span class="org-builtin">:workspace-index</span> 2
                    <span class="org-builtin">:persp-name</span> <span class="org-string">"Web"</span>))
    (<span class="org-string">"Thunar"</span> (<span class="org-keyword">progn</span>
                (exwm-workspace-add 3)
                (perspective-exwm-assign-window
                 <span class="org-builtin">:workspace-index</span> 3
                 <span class="org-builtin">:persp-name</span> <span class="org-string">"Files"</span>)))
    (<span class="org-string">"Spotify"</span> (perspective-exwm-assign-window
                <span class="org-builtin">:workspace-index</span> 4
                <span class="org-builtin">:persp-name</span> <span class="org-string">"Multimedia"</span>))
    (<span class="org-string">"Cheese"</span> (perspective-exwm-assign-window
               <span class="org-builtin">:workspace-index</span> 4
               <span class="org-builtin">:persp-name</span> <span class="org-string">"Multimedia"</span>))
    (<span class="org-string">"Picard"</span> (perspective-exwm-assign-window
               <span class="org-builtin">:workspace-index</span> 4
               <span class="org-builtin">:persp-name</span> <span class="org-string">"Multimedia"</span>))
    (<span class="org-string">"hakuneko-desktop"</span> (perspective-exwm-assign-window
                         <span class="org-builtin">:workspace-index</span> 4
                         <span class="org-builtin">:persp-name</span> <span class="org-string">"Multimedia"</span>))
    (<span class="org-string">"mpv"</span> (<span class="org-keyword">progn</span>
             (perspective-exwm-assign-window
              <span class="org-builtin">:workspace-index</span> 4
              <span class="org-builtin">:persp-name</span> <span class="org-string">"Multimedia"</span>)
             (exwm-floating-toggle-floating)))
    (<span class="org-string">"vlc"</span> (<span class="org-keyword">progn</span> (perspective-exwm-assign-window
                   <span class="org-builtin">:workspace-index</span> 4
                   <span class="org-builtin">:persp-name</span> <span class="org-string">"Multimedia"</span>)
                  (exwm-floating-toggle-floating)))
    (<span class="org-string">"Gimp"</span> (<span class="org-keyword">progn</span>
              (exwm-input-set-local-simulation-keys nil)
              (exwm-floating-toggle-floating)
              (perspective-exwm-assign-window
               <span class="org-builtin">:workspace-index</span> 4
               <span class="org-builtin">:persp-name</span> <span class="org-string">"Multimedia"</span>)))
    (<span class="org-string">"TelegramDesktop"</span> (perspective-exwm-assign-window
                        <span class="org-builtin">:workspace-index</span> 5
                        <span class="org-builtin">:persp-name</span> <span class="org-string">"Chat"</span>))
    (<span class="org-string">"Virt-manager"</span> (perspective-exwm-assign-window
                     <span class="org-builtin">:workspace-index</span> 6
                     <span class="org-builtin">:persp-name</span> <span class="org-string">"Remotes"</span>))
    (<span class="org-string">"Vncviewer"</span>
     (<span class="org-keyword">progn</span>
       (exwm-floating-toggle-floating)
       (perspective-exwm-assign-window
        <span class="org-builtin">:workspace-index</span> 6
        <span class="org-builtin">:persp-name</span> <span class="org-string">"Remotes"</span>)))
    (<span class="org-string">"Org.remmina.Remmina"</span> (perspective-exwm-assign-window
                            <span class="org-builtin">:workspace-index</span> 6
                            <span class="org-builtin">:persp-name</span> <span class="org-string">"Remotes"</span>))
    (<span class="org-string">"libreoffice-startcenter"</span>
     (<span class="org-keyword">progn</span>
       (exwm-input-set-local-simulation-keys nil)
       (perspective-exwm-assign-window
        <span class="org-builtin">:workspace-index</span> 8
        <span class="org-builtin">:persp-name</span> <span class="org-string">"Work"</span>)))
    (<span class="org-string">"libreoffice-writer"</span>
     (<span class="org-keyword">progn</span>
       (exwm-input-set-local-simulation-keys nil)
       (perspective-exwm-assign-window
        <span class="org-builtin">:workspace-index</span> 8
        <span class="org-builtin">:persp-name</span> <span class="org-string">"Work"</span>)))
    (<span class="org-string">"libreoffice-calc"</span>
     (<span class="org-keyword">progn</span>
       (exwm-input-set-local-simulation-keys nil)
       (perspective-exwm-assign-window
        <span class="org-builtin">:workspace-index</span> 8
        <span class="org-builtin">:persp-name</span> <span class="org-string">"Work"</span>)))
    (<span class="org-string">"libreoffice-draw"</span>
     (<span class="org-keyword">progn</span>
       (exwm-input-set-local-simulation-keys nil)
       (perspective-exwm-assign-window
        <span class="org-builtin">:workspace-index</span> 8
        <span class="org-builtin">:persp-name</span> <span class="org-string">"Work"</span>)))
    (<span class="org-string">"libreoffice-math"</span>
     (<span class="org-keyword">progn</span>
       (exwm-input-set-local-simulation-keys nil)
       (perspective-exwm-assign-window
        <span class="org-builtin">:workspace-index</span> 8
        <span class="org-builtin">:persp-name</span> <span class="org-string">"Work"</span>)))
    (<span class="org-string">"gsi"</span> (exwm-input-toggle-keyboard))))
</pre>
</div>
<p>
This will configure window based on their <code>exwm-class-name</code>. To be run inside <code>exwm-manage-finish-hook</code>.
</p>
</div>
</li>
<li><a id="org492293e"></a>Switch to last workspace<br>
<div class="outline-text-5" id="text-org492293e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'exwm
  (<span class="org-keyword">defun</span> <span class="org-function-name">+config/exwm-workspace-switch-to-last</span> ()
    <span class="org-doc">"Switch to last visited workspace."</span>
    (<span class="org-keyword">interactive</span>)
    <span class="org-string">"Switch to the workspace that was used before current workspace"</span>
    (exwm-workspace-switch (cdr +config/exwm-workspace--switch-history-hack))))
</pre>
</div>
<p>
A function to mimick the <code>workspace-back-and-forth</code> function in <i>i3wm</i>.
</p>
</div>
</li>
<li><a id="orgb74146c"></a>logout<br>
<div class="outline-text-5" id="text-orgb74146c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+config/exwm-logout</span> ()
  <span class="org-doc">"Logout cleanly from EXWM."</span>
  (<span class="org-keyword">interactive</span>)
  (recentf-save-list)
  (save-some-buffers)
  (save-buffers-kill-terminal))
</pre>
</div>
<p>
A wrapper function to safely exit <i>Emacs</i>.
</p>
</div>
</li>
<li><a id="org159337f"></a>Terminal<br>
<div class="outline-text-5" id="text-org159337f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+config/exwm-terminal</span> ()
  <span class="org-doc">"Set the default terminal."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((terminal
         (<span class="org-keyword">or</span>
          (getenv <span class="org-string">"TERMINAL"</span>)
          (executable-find <span class="org-string">"xterm"</span>)
          (executable-find <span class="org-string">"urxvt"</span>)
          (executable-find <span class="org-string">"termite"</span>))))
    (exwm/run-in-background terminal)
    (message <span class="org-string">"s-&lt;f11&gt; to toggle fullscreen"</span>)))
</pre>
</div>
<p>
Wrapper function for terminal emulators.
</p>
</div>
</li>
<li><a id="org8d152f0"></a>rofi<br>
<div class="outline-text-5" id="text-org8d152f0">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">+config/rofi-launcher</span> ()
  <span class="org-doc">"Run rofi."</span>
  (<span class="org-keyword">interactive</span>)
  (exwm/run-in-background <span class="org-string">"rofi -show drun"</span>))
</pre>
</div>
<p>
Wrapper function for <i>rofi</i>. Visually better than <code>async-shell-command</code>, which is the builtin way to execute command asynchronously in the background.
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-org354d042" class="outline-4">
<h4 id="org354d042">Variables</h4>
<div class="outline-text-4" id="text-org354d042">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'exwm-workspace-warp-cursor t)
(customize-set-variable 'mouse-autoselect-window t)
(customize-set-variable 'focus-follows-mouse t)
(customize-set-variable 'exwm-workspace-number 10)
(customize-set-variable 'persp-initial-frame-name <span class="org-string">"Main"</span>)
(<span class="org-keyword">if</span> +emacs-data-dir
    (customize-set-variable 'persp-state-default-file (expand-file-name <span class="org-string">"statesave"</span> +emacs-data-dir))
  (<span class="org-keyword">progn</span> (<span class="org-keyword">let</span> ((emacs-data-dir (expand-file-name <span class="org-string">".local/share/emacs"</span> (getenv <span class="org-string">"HOME"</span>))))
           (customize-set-variable 'persp-state-default-file (expand-file-name <span class="org-string">"statesave"</span> emacs-data-dir)))))
(customize-set-variable 'persp-mode-prefix-key (kbd <span class="org-string">"C-c b"</span>))
</pre>
</div>
<p>
These are variables related to the <i>EXWM</i> package and builtin <i>Emacs</i>:
</p>
<dl class="org-dl">
<dt>exwm-workspace-warp-cursor</dt><dd>warp cursor automatically after workspace switch.</dd>
<dt>exwm-workspace-number</dt><dd>Initial number of workspaces.</dd>
<dt>mouse-autoselect-window</dt><dd>autoselect window with mouse pointer (<i>Emacs</i> builtin).</dd>
<dt>persp-initial-frame-name</dt><dd>Name used for the initial perspective when enabling <code>persp-mode</code>.</dd>
<dt>persp-state-default-file</dt><dd>The file location for <code>persp-state-save</code> and <code>persp-state-load</code>. The variable declaration is wrapped inside a function to guard in case <code>+emacs-data-dir</code> is unbound (this is a custom variable from my <i>Emacs</i> <a href="../blog/posts/Emacs-Configuration.html">configuration</a>).</dd>
<dt>persp-mode-prefix-key</dt><dd>The prefix keybinding for activating <code>perspective-map</code>. Before <i>Emacs</i> version 28 the value for this variable is automatically set to <code>C-x x</code>. It&rsquo;s unset in <i>Emacs</i> 28 since <code>C-x x</code> is used. I set this explicitly to <code>C-c b</code> (the <i>FreeBSD</i> ports used <i>Emacs</i> 27.2).</dd>
</dl>
<p>
There are many other <i>EXWM</i>-related variables that can be set, see their <a href="https://github.com/ch11ng/exwm/wiki">github wiki</a> for a full listing. For other <i>Emacs</i> non windows or frame specific variables, it&rsquo;s better to put them inside <code>user-init-file</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'exwm
  (<span class="org-keyword">defvar</span> <span class="org-variable-name">+config/exwm-workspace--switch-history-hack</span> (cons exwm-workspace-current-index '())))
</pre>
</div>
<p>
This variable is for <code>exwm-workspace-switch-hook</code>.
</p>
</div>
</div>
</div>
<div id="outline-container-orgb7c6e53" class="outline-3">
<h3 id="orgb7c6e53">Global configuration</h3>
<div class="outline-text-3" id="text-orgb7c6e53">
</div>
<div id="outline-container-org4151b30" class="outline-4">
<h4 id="org4151b30">Cosmetic tweaks</h4>
<div class="outline-text-4" id="text-org4151b30">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Disable menu-bar, tool-bar and scroll-bar to increase the usable space.</span>
(menu-bar-mode -1)
(tool-bar-mode -1)
(scroll-bar-mode -1)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Also shrink fringes to 1 pixel.</span>
(fringe-mode 1)
</pre>
</div>
<p>
I like to have my workspace (frame/buffer) free from distraction. Off course this is my personal preference.
</p>
</div>
</div>
<div id="outline-container-orgd21f715" class="outline-4">
<h4 id="orgd21f715">Time</h4>
<div class="outline-text-4" id="text-orgd21f715">
<p>
I&rsquo;m not planning on using any panel, so I&rsquo;ll need a time indicator in the <i>Emacs</i> modeline.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">time</span>)
(<span class="org-keyword">setq</span> display-time-default-load-average nil)
(customize-set-variable 'display-time-24hr-format t)
(customize-set-variable 'display-time-day-and-date t)
(display-time-mode 1)
</pre>
</div>
<dl class="org-dl">
<dt>display-time-default-load-average</dt><dd>Which load average value will be shown in the mode line. Almost every system can provide values of load for the past 1 minute,</dd>
</dl>
<p>
past 5 or past 15 minutes. The default is to display 1-minute load average. The other options are <code>1</code> for 5 minutes load, <code>2</code> for 15 minutes load, <code>nil</code> for none (do not display the load average).
</p>
</div>
</div>
<div id="outline-container-org723f015" class="outline-4">
<h4 id="org723f015">start in server-mode</h4>
<div class="outline-text-4" id="text-org723f015">
<p>
Emacs server is not required to run EXWM but it has some interesting uses.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (fboundp 'server-running-p)
         (not (server-running-p)))
    (server-start))
</pre>
</div>
</div>
</div>
<div id="outline-container-orge6f5a00" class="outline-4">
<h4 id="orge6f5a00">recentf</h4>
<div class="outline-text-4" id="text-orge6f5a00">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">recentf</span>)
</pre>
</div>
<p>
In case <i>recentf</i> is not loaded.
</p>
</div>
</div>
</div>
<div id="outline-container-org32db95e" class="outline-3">
<h3 id="org32db95e"><code>perspective</code> and <code>perspective-exwm</code></h3>
<div class="outline-text-3" id="text-org32db95e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">perspective</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">perspective-exwm</span>)
</pre>
</div>
<p>
I use these packages in order to have a &rsquo;traditional window manager&rsquo; feel in regard to workspaces. In actuality, since this is basically <i>Emacs</i> every window resides inside an <i>Emacs</i> buffer. We can use the usual <i>Emacs</i> buffer operations to manage windows, so it&rsquo;s fine just to have one workspace.
I&rsquo;ve used <i>perspective</i> even before I started using <i>EXWM</i>, it&rsquo;s useful for managing set of files in their separate &ldquo;views&rdquo; (<i>perspectives</i>), so in example, I can have one perspective containing buffers related to my blog files (it can be any <i>Emacs</i> buffers, like <i>dired</i>, <i>eshell</i>, etc.), and one buffer only related to my current <i>ssh</i> connections.
<code>perspective-exwm</code> further integrates <i>perspective</i> into <i>EXWM</i>, adding couples of fixes and enhancements. <code>perspective-exwm-override-initial-name</code> is handy to automatically set name for each workspaces:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'perspective-exwm-override-initial-name
                        '((0 . <span class="org-string">"Term"</span>)
                          (1 . <span class="org-string">"Dev"</span>)
                          (2 . <span class="org-string">"Web"</span>)
                          (3 . <span class="org-string">"Files"</span>)
                          (4 . <span class="org-string">"Multimedia"</span>)
                          (5 . <span class="org-string">"Chat"</span>)
                          (6 . <span class="org-string">"Remotes"</span>)
                          (7 . <span class="org-string">"Games"</span>)
                          (8 . <span class="org-string">"Work"</span>)
                          (9 . <span class="org-string">"Others"</span>)))
</pre>
</div>
<p>
As you can probably tell, workspaces in <i>EXWM</i> starts with <code>0</code>.
</p>
</div>
</div>
<div id="outline-container-org1d0ff2d" class="outline-3">
<h3 id="org1d0ff2d">gpg</h3>
<div class="outline-text-3" id="text-org1d0ff2d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(setenv <span class="org-string">"GPG_AGENT_INFO"</span> nil)  <span class="org-comment-delimiter">;; </span><span class="org-comment">use emacs pinentry</span>
(<span class="org-keyword">setq</span> auth-source-debug t)

(<span class="org-keyword">setq</span> epg-gpg-program <span class="org-string">"gpg2"</span>)  <span class="org-comment-delimiter">;; </span><span class="org-comment">not necessary</span>
(<span class="org-keyword">require</span> '<span class="org-constant">epa-file</span>)
(<span class="org-keyword">unless</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">epa</span>)
  (epa-file-enable))
(<span class="org-keyword">setq</span> epa-pinentry-mode 'loopback)
(<span class="org-keyword">setq</span> epg-pinentry-mode 'loopback)
(pinentry-start)

(<span class="org-keyword">require</span> '<span class="org-constant">org-crypt</span>)
(org-crypt-use-before-save-magic)
</pre>
</div>
<p>
This is for using <i>pinentry</i> inside <i>Emacs</i>. The <i>gpg-agent</i> configuration should also have this:
</p>
<pre class="example" id="org9693bb7">
allow-emacs-pinentry
allow-loopback-pinentry
</pre>
<p>
The environment variable <code>${GPG_TTY}</code> should also be set (via <code>~/.xprofile</code> or <code>~/.profile</code>).
</p>
</div>
</div>
<div id="outline-container-orgb29c481" class="outline-3">
<h3 id="orgb29c481">Desktop Environment</h3>
<div class="outline-text-3" id="text-orgb29c481">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(customize-set-variable 'desktop-environment-brightness-small-increment <span class="org-string">"1%+"</span>)
(customize-set-variable 'desktop-environment-brightness-small-decrement <span class="org-string">"1%-"</span>)
(customize-set-variable 'desktop-environment-brightness-normal-increment <span class="org-string">"1%+"</span>)
(customize-set-variable 'desktop-environment-brightness-normal-decrement <span class="org-string">"1%-"</span>)
(customize-set-variable 'desktop-environment-volume-normal-decrement <span class="org-string">"1%-"</span>)
(customize-set-variable 'desktop-environment-volume-normal-increment <span class="org-string">"1%+"</span>)
(customize-set-variable 'desktop-environment-screenshot-directory (expand-file-name <span class="org-string">"Screenshots/"</span> (getenv <span class="org-string">"XDG_PICTURES_DIR"</span>)))
(<span class="org-keyword">unless</span> (file-directory-p desktop-environment-screenshot-directory)
  (make-directory desktop-environment-screenshot-directory <span class="org-builtin">:parents</span>))
</pre>
</div>
<p>
The variables for <i>Desktop Environment mode</i>. See their <a href="https://github.com/DamienCassou/desktop-environment">github repo</a> for details.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'desktop-environment
  (global-set-key (kbd <span class="org-string">"M-s-&lt;f12&gt;"</span>) 'desktop-environment-music-next)
  (global-set-key (kbd <span class="org-string">"M-s-&lt;f11&gt;"</span>) 'desktop-environment-toggle-music)
  (global-set-key (kbd <span class="org-string">"M-s-&lt;f10&gt;"</span>) 'desktop-environment-music-previous)
  (global-set-key (kbd <span class="org-string">"M-s-&lt;f9&gt;"</span>) 'desktop-environment-volume-increment)
  (global-set-key (kbd <span class="org-string">"M-s-&lt;f8&gt;"</span>) 'desktop-environment-volume-decrement)
  (global-set-key (kbd <span class="org-string">"M-s-&lt;f7&gt;"</span>) 'desktop-environment-toggle-mute))
(desktop-environment-mode)
</pre>
</div>
<p>
Sets the keybinding for various <i>desktop-environment</i> functions.
</p>
</div>
</div>
<div id="outline-container-org19f913a" class="outline-3">
<h3 id="org19f913a">Battery</h3>
<div class="outline-text-3" id="text-org19f913a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">battery</span>)
(<span class="org-keyword">with-eval-after-load</span> 'battery
  (<span class="org-keyword">when</span>
      (<span class="org-keyword">or</span>
       (eq battery-status-function
           'battery-bsd-apm)
       (eq battery-status-function
           'battery-linux-sysfs)
       (eq battery-status-function
           'battery-linux-proc-apm)
       (eq battery-status-function
           'battery-linux-proc-acpi))
    (display-battery-mode)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org8c293fc" class="outline-3">
<h3 id="org8c293fc">EXWM</h3>
<div class="outline-text-3" id="text-org8c293fc">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">exwm</span>)
</pre>
</div>
</div>
<div id="outline-container-org6532b33" class="outline-4">
<h4 id="org6532b33">hooks</h4>
<div class="outline-text-4" id="text-org6532b33">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'exwm-init-hook #'+config/exwm-init-hook)
</pre>
</div>
<p>
Calls the function <code>+config/exwm-init-hook</code> defined <a href="#org8766ea9">earlier</a>.
</p>
</div>
</div>
<div id="outline-container-org7cb304a" class="outline-4">
<h4 id="org7cb304a">hide the modeline on all floating windows</h4>
<div class="outline-text-4" id="text-org7cb304a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'exwm-floating-setup-hook
          (<span class="org-keyword">lambda</span> ()
            (exwm-layout-hide-mode-line)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org52b1c5e" class="outline-4">
<h4 id="org52b1c5e">update title hook</h4>
<div class="outline-text-4" id="text-org52b1c5e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'exwm-update-title-hook
          (<span class="org-keyword">lambda</span> ()
            (<span class="org-keyword">when</span> (<span class="org-keyword">or</span> (not exwm-instance-name)
                      (string-prefix-p <span class="org-string">"sun-awt-X11-"</span> exwm-instance-name)
                      (string= <span class="org-string">"gimp"</span> exwm-instance-name))
              (exwm-workspace-rename-buffer exwm-title))))
</pre>
</div>
<dl class="org-dl">
<dt>exwm-update-title-hook</dt><dd>The hook runs when window title is updated.</dd>
</dl>
<p>
Basically this hooks will rename the buffer name to the current window title, unless the <code>exwm-instance-name</code> is null, or equal to <i>sun-awt-X11</i> or <i>gimp</i>. This is from the EXWM <a href="https://github.com/ch11ng/exwm/wiki">wiki</a>, I should update this.
</p>
</div>
</div>
<div id="outline-container-org7785583" class="outline-4">
<h4 id="org7785583">floating setup hook</h4>
<div class="outline-text-4" id="text-org7785583">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'exwm-floating-setup-hook #'+config/fix-exwm-floating-windows)
</pre>
</div>
<p>
Calls the <code>+config/fix-exwm-floating-windows</code> <a href="#org2fa06be">function</a>. Will run when an X window has been made floating, in the context of the corresponding buffer.
</p>
</div>
</div>
<div id="outline-container-orgab4af03" class="outline-4">
<h4 id="orgab4af03">exwm-manage-finish-hook</h4>
<div class="outline-text-4" id="text-orgab4af03">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'exwm-manage-finish-hook
          (<span class="org-keyword">lambda</span> ()
            <span class="org-comment-delimiter">;; </span><span class="org-comment">Send the window where it belongs</span>
            (+config/setup-window-by-class)))
</pre>
</div>
<p>
This hook will call the <code>+config/setup-window-by-class</code> <a href="#orgab4af03">function</a>, will run after a window is just managed, in the context of the corresponding buffer.
</p>
</div>
</div>
<div id="outline-container-org018e614" class="outline-4">
<h4 id="org018e614">exwm-workspace-switch-hook</h4>
<div class="outline-text-4" id="text-org018e614">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'exwm-workspace-switch-hook
          (<span class="org-keyword">lambda</span> ()
            (<span class="org-keyword">setq</span> +config/exwm-workspace--switch-history-hack
                  (cons exwm-workspace-current-index
                        (car +config/exwm-workspace--switch-history-hack)))))
</pre>
</div>
<p>
The lambda function basically creates an alist containing the current workspace index and the previous workspace index. Used for switching back and forth between current and last workspaces.
</p>
</div>
</div>
<div id="outline-container-orgb13758f" class="outline-4">
<h4 id="orgb13758f">bind the logout function</h4>
<div class="outline-text-4" id="text-orgb13758f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(exwm-input-set-key (kbd <span class="org-string">"C-x C-c"</span>) '+config/exwm-logout)
</pre>
</div>
<p>
<code>exwm-input-set-key</code> is an alternative way to define a key binding inside <i>EXWM</i>. With the recommended way is:
</p>
</div>
</div>
<div id="outline-container-org1a198ed" class="outline-4">
<h4 id="org1a198ed">exwm-input-global-key</h4>
<div class="outline-text-4" id="text-org1a198ed">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> exwm-input-global-keys
      `(
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Bind "s-r" to exit char-mode and fullscreen mode.</span>
        ([?\s-r] . exwm-reset)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Bind "s-w" to switch workspace interactively.</span>
        ([?\s-w] . exwm-workspace-switch)
        ([?\s-q] . delete-window)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Bind "s-0" to "s-9" to switch to a workspace by its index.</span>
        ,@(mapcar (<span class="org-keyword">lambda</span> (i)
                    `(,(kbd (format <span class="org-string">"s-%d"</span> i)) .
                      (<span class="org-keyword">lambda</span> ()
                        (<span class="org-keyword">interactive</span>)
                        (exwm-workspace-switch-create ,i))))
                  (number-sequence 0 9))
        ([s-tab] . +config/exwm-workspace-switch-to-last)
        ([s-return] . +config/exwm-terminal)
        ([?\s-d] . +config/rofi-launcher)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Bind "s-&amp;" to launch applications ('M-&amp;' also works if the output</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">buffer does not bother you).</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">([?\s-d] . (lambda (command)</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">          (interactive (list (read-shell-command "$ ")))</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">(start-process-shell-command command nil command)))</span>
        ([s-f11] . exwm-layout-toggle-fullscreen)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Bind "s-&lt;f2&gt;" to "slock", a simple X display locker.</span>
        ([s-f1] . (<span class="org-keyword">lambda</span> ()
                    (<span class="org-keyword">interactive</span>)
                    (start-process <span class="org-string">""</span> nil <span class="org-string">"/usr/bin/slock"</span>)))))
</pre>
</div>
<p>
This variables is an alist of the form <code>(key . command)</code>, meaning giving <code>key</code> (a key sequence) a global binding as <code>command</code>. Setting the value directly (rather than customizing it) after <i>EXWM</i> finishes initialization has no effect. Most of this is still from the <i>EXWM</i> <a href="https://github.com/ch11ng/exwm/wiki">wiki</a>, with the exceptions in <code>slock</code>, <code>+config/rofi-launcher</code>, <code>+config/exwm-terminal</code> and <code>+config/exwm-workspace-switch-to-last</code>.
</p>
</div>
</div>
<div id="outline-container-org3fa6e4a" class="outline-4">
<h4 id="org3fa6e4a">Keybinding to pass the next key</h4>
<div class="outline-text-4" id="text-org3fa6e4a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(define-key exwm-mode-map [?\C-q] #'exwm-input-send-next-key)
</pre>
</div>
<p>
This defines a key binding in the <code>exwm-mode-map</code> major mode, in order to pass a key binding that already defined in the major mode, to the current window.
</p>
</div>
</div>
<div id="outline-container-orge472c8f" class="outline-4">
<h4 id="orge472c8f">minibuffer position</h4>
<div class="outline-text-4" id="text-orge472c8f">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;</span><span class="org-comment">(setq exwm-workspace-minibuffer-position 'bottom)</span>
</pre>
</div>
<p>
This hides the minibuffer and echo area.
</p>
</div>
</div>
<div id="outline-container-org99cb0e4" class="outline-4">
<h4 id="org99cb0e4">input-simulation key</h4>
<div class="outline-text-4" id="text-org99cb0e4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> exwm-input-simulation-keys
      '(
        <span class="org-comment-delimiter">;; </span><span class="org-comment">movement</span>
        ([?\C-b] . [left])
        ([?\M-b] . [C-left])
        ([?\C-f] . [right])
        ([?\M-f] . [C-right])
        ([?\C-p] . [up])
        ([?\C-n] . [down])
        ([?\C-a] . [home])
        ([?\C-e] . [end])
        ([?\M-v] . [prior])
        ([?\C-v] . [next])
        ([?\C-d] . [delete])
        ([?\C-k] . [S-end delete])
        <span class="org-comment-delimiter">;; </span><span class="org-comment">cut/paste.</span>
        ([?\C-w] . [?\C-x])
        ([?\M-w] . [?\C-c])
        ([?\C-y] . [?\C-v])
        <span class="org-comment-delimiter">;; </span><span class="org-comment">search</span>
        ([?\C-s] . [?\C-f])))
</pre>
</div>
<p>
<code>exwm-input-simulation-keys</code> is an alist of the form (original-key . simulated-key), where both original-key and simulated-key are key sequences. Original-key is what you type to an X window in line-mode which then gets translated to simulated-key by EXWM and forwarded to the X window.
</p>

<p>
The codeblock above demonstrates how to use simulation keys to mimic the behavior of Emacs. The value of <code>exwm-input-simulation-keys</code> is a list of <i>cons</i> cells <code>(SRC . DEST)</code>, where <i>SRC</i> is the key sequence you press and <i>DEST</i> is what <i>EXWM</i> actually sends to application. Note that both <i>SRC</i> and <i>DEST</i> should be key sequences (vector or string).
</p>
</div>
</div>
<div id="outline-container-org7868f9c" class="outline-4">
<h4 id="org7868f9c">start perspective-exwm</h4>
<div class="outline-text-4" id="text-org7868f9c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">perspective-exwm</span>)
(perspective-exwm-mode)
</pre>
</div>
</div>
</div>
<div id="outline-container-org0ddc302" class="outline-4">
<h4 id="org0ddc302">system tray</h4>
<div class="outline-text-4" id="text-org0ddc302">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">exwm-systemtray</span>)
(exwm-systemtray-enable)
(<span class="org-keyword">setq</span> exwm-systemtray-height 25) <span class="org-comment-delimiter">; </span><span class="org-comment">default 16</span>
</pre>
</div>
<p>
I don&rsquo;t use it, but keep it inside the configuration file for reference.
</p>
</div>
</div>
<div id="outline-container-orgec39dde" class="outline-4">
<h4 id="orgec39dde">enable exwm</h4>
<div class="outline-text-4" id="text-orgec39dde">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(exwm-enable)
</pre>
</div>
<p>
This function can be placed anywhere.
</p>
</div>
</div>
</div>
</section>
<section id="outline-container-org13786de" class="outline-2">
<h2 id="org13786de">Screenshots</h2>
<div class="outline-text-2" id="text-org13786de">
<p class="center no-border" width="75%" height="75%">
<img src="../images/posts/vanilla-exwm-firefox.png" alt="vanilla-exwm-firefox.png" class="center no-border" width="75%" height="75%">
<i>EXWM</i> with (almost) no <i>Emacs</i> configurations (and yes, <i>Emacs</i> can open images too).
</p>


<figure id="orga4114af">
<img src="../images/posts/exwm-with-emacs-config.png" alt="exwm-with-emacs-config.png" class="center no-border" width="75%" height="75%">

<figcaption><span class="figure-number">Figure 1: </span>exwm with my emacs config</figcaption>
</figure>


<figure id="org3c81aee">
<img src="../images/posts/exwm-scratch.png" alt="exwm-scratch.png" class="center no-border" width="75%" height="75%">

<figcaption><span class="figure-number">Figure 2: </span>exwm scratch</figcaption>
</figure>

<script src="https://utteranc.es/client.js"repo="alexforsale/blog" issue-term="pathname" label="utterances" theme="gruvbox-dark" crossorigin="anonymous" async></script>
</div>
</section>
</main>
<footer id="postamble" class="status">
<div class='footer'>
  Copyright Â© 2012-2022 <a href='mailto:alexforsale@yahoo.com'>alexforsale</a> | <a href='https://github.com/alexforsale/blog'>Source</a> <br>
  GnuPG fingerprint: <a href='https://keys.openpgp.org/search?q=27517709E592F14C5A51D90B972B3C2D613E4AE9'>2751 7709 E592 F14C 5A51 D90B 972B 3C2D 613E 4AE9</a> <br>
  Last updated on Jun 03, 2022. Generated using <a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.3 (<a href="https://orgmode.org">Org</a> mode 9.5.4) <br>
  <a href="https://info.flagcounter.com/yNMj"><img src="https://s05.flagcounter.com/mini/yNMj/bg_FFFFFF/txt_000000/border_CCCCCC/flags_0/" alt="Flag Counter" border="0"></a>
</div>
</footer>
</body>
</html>
